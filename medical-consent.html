<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medical Consent Form • SHNP</title>
  <meta name="description" content="Submit medical consent for your student. This form goes straight to SHNP staff through HubSpot." />

  <!-- Fonts and global site styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
  <!-- Page specific styles -->
  <link rel="stylesheet" href="css/mc.css" />
</head>
<body>
  <!-- Top strip -->
  <div class="top-strip">
    <div class="container top-strip__inner">
      <div class="kicker">Why Step Higher?</div>
      <div class="scroller" aria-hidden="true">
        <div class="scroller__track">
          <span>College readiness</span>
          <span>Mentorship</span>
          <span>Scholarships</span>
          <span>Accredited care at Nella's Place</span>
          <span>Community impact</span>
          <span>College readiness</span>
          <span>Mentorship</span>
          <span>Scholarships</span>
          <span>Accredited care at Nella's Place</span>
          <span>Community impact</span>
        </div>
      </div>
      <a class="btn-ghost" href="donate.html" aria-label="Donate">Donate</a>
    </div>
  </div>

  <!-- HubSpot -->
  <script type="text/javascript" id="hs-script-loader" async defer src="//js-na2.hs-scripts.com/243496281.js"></script>

  <!-- Header / Nav (UNIFIED) -->
  <header class="header">
    <nav class="container nav" role="navigation" aria-label="Main">
      <!-- Brand -->
      <a class="brand" href="index.html" aria-label="SHNP home">
        <div class="logo" aria-hidden="true"></div>
        SHNP
      </a>

      <!-- Primary nav -->
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="tours.html">Tours</a></li>
        <li><a href="nellas-place.html">Nella’s Place</a></li>
        <li><a href="our-story.html">Our Story</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>

      <!-- Hamburger / overflow -->
      <div class="menu-wrap">
        <button class="btn-menu menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="hamburger-dropdown">☰</button>
        <div id="hamburger-dropdown" class="hamburger-dropdown" role="menu" aria-label="More pages">
          <a href="scholarships.html" role="menuitem" tabindex="-1">Scholarships</a>
          <a href="blog.html" role="menuitem" tabindex="-1">Blog</a>
          <a href="careers.html" role="menuitem" tabindex="-1">Careers</a>
          <a href="#footer" role="menuitem" tabindex="-1">Resources</a>
          <a href="volunteer.html" role="menuitem" tabindex="-1">Volunteer</a>
          <a href="privacy-policy.html" role="menuitem" tabindex="-1">Privacy</a>
          <a href="terms.html" role="menuitem" tabindex="-1">Terms</a>
        </div>
      </div>

      <a class="btn-donate" href="donate.html" aria-label="Donate">Donate</a>
    </nav>
  </header>

  <!-- Hero -->
  <section class="mc-hero">
    <div class="container mc-hero__inner">
      <div class="mc-badge">Secure form</div>
      <h1>Medical Consent</h1>
      <p class="muted">Complete the form and paste a link to your signed consent file. Submissions go straight to our staff in HubSpot.</p>
    </div>
    <div class="mc-blob" aria-hidden="true"></div>
  </section>

  <!-- Form section -->
  <section class="section">
    <div class="container mc-wrap">
      <div class="mc-card">
        <form id="mcForm" novalidate>
          <!-- Parent / guardian -->
          <div class="mc-group-title">Parent or Guardian</div>
          <div class="grid grid-2">
            <div class="field">
              <label for="parent_name">Full name *</label>
              <input id="parent_name" name="parent_name" class="input" required placeholder="First and last name" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="parent_email">Email *</label>
              <input id="parent_email" name="parent_email" type="email" class="input" required placeholder="name@example.com" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="parent_phone">Phone *</label>
              <input id="parent_phone" name="parent_phone" type="tel" class="input" required placeholder="(xxx) xxx-xxxx" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="relationship">Relationship to student *</label>
              <input id="relationship" name="relationship" class="input" required placeholder="Parent, guardian, other" />
              <small class="error"></small>
            </div>
          </div>

          <!-- Student info -->
          <div class="mc-group-title">Student</div>
          <div class="grid grid-2">
            <div class="field">
              <label for="student_first">First name *</label>
              <input id="student_first" name="student_first" class="input" required placeholder="First name" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="student_last">Last name *</label>
              <input id="student_last" name="student_last" class="input" required placeholder="Last name" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="student_dob">Date of birth *</label>
              <input id="student_dob" name="student_dob" type="date" class="input" required />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="student_grade">Current grade</label>
              <input id="student_grade" name="student_grade" class="input" placeholder="Optional" />
              <small class="error"></small>
            </div>
          </div>

          <!-- Medical details -->
          <div class="mc-group-title">Medical details</div>
          <div class="grid grid-2">
            <div class="field">
              <label for="provider">Primary care provider</label>
              <input id="provider" name="provider" class="input" placeholder="Clinic or doctor name" />
            </div>
            <div class="field">
              <label for="provider_phone">Provider phone</label>
              <input id="provider_phone" name="provider_phone" class="input" placeholder="(xxx) xxx-xxxx" />
            </div>
            <div class="field grid-span-2">
              <label for="insurance">Insurance info</label>
              <input id="insurance" name="insurance" class="input" placeholder="Provider and policy number" />
            </div>
            <div class="field grid-span-2">
              <label for="allergies">Allergies</label>
              <textarea id="allergies" name="allergies" rows="3" class="input" placeholder="List any allergies"></textarea>
            </div>
            <div class="field grid-span-2">
              <label for="medications">Current medications</label>
              <textarea id="medications" name="medications" rows="3" class="input" placeholder="List medications and dosages"></textarea>
            </div>
          </div>

          <!-- Consent file link slot -->
          <div class="mc-group-title">Consent file</div>
          <div class="upload-slot">
            <div class="upload-copy">
              <strong>Upload the signed consent file using your preferred tool</strong>
              <p class="muted">Click the button to open your upload page, or use Drive, Dropbox, or your school portal. Then paste the share link below.</p>
            </div>
            <div class="upload-cta">
              <button class="btn btn-ghost" id="openUpload" type="button">Open upload page</button>
            </div>
          </div>
          <div class="field">
            <label for="consent_url">Paste the file link *</label>
            <input id="consent_url" name="consent_url" class="input" required placeholder="https://drive.google.com/... or https://dropbox.com/..." />
            <small class="error"></small>
          </div>

          <!-- Agreements -->
          <div class="mc-group-title">Agreements</div>
          <div class="checks">
            <label class="check">
              <input type="checkbox" id="agree_treatment" required />
              <span>I authorize SHNP to seek emergency treatment for the student if needed.</span>
            </label>
            <label class="check">
              <input type="checkbox" id="agree_share" required />
              <span>I consent to sharing relevant medical info with program staff and care providers.</span>
            </label>
          </div>

          <!-- Signature -->
          <div class="grid grid-2">
            <div class="field">
              <label for="signature_name">Type your name as signature *</label>
              <input id="signature_name" name="signature_name" class="input" required placeholder="Parent or guardian name" />
              <small class="error"></small>
            </div>
            <div class="field">
              <label for="signature_date">Date *</label>
              <input id="signature_date" name="signature_date" type="date" class="input" required />
              <small class="error"></small>
            </div>
          </div>

          <!-- Notes -->
          <div class="field">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="4" class="input" placeholder="Anything else we should know"></textarea>
          </div>

          <!-- Actions -->
          <div class="mc-actions">
            <button id="submitBtn" type="submit" class="btn btn-primary">Submit</button>
            <button type="reset" class="btn btn-ghost">Reset</button>
            <div class="mc-inline-status" id="inlineStatus" role="status" aria-live="polite"></div>
          </div>
        </form>
      </div>

      <!-- Side panel with tips -->
      <aside class="mc-side">
        <div class="mc-tip">
          <h3>What you will need</h3>
          <ul>
            <li>Parent or guardian contact info</li>
            <li>Student name and date of birth</li>
            <li>Doctor and insurance details</li>
            <li>A link to the signed consent file</li>
          </ul>
        </div>
        <div class="mc-tip">
          <h3>Privacy</h3>
          <p class="muted">Your submission goes straight to SHNP staff in HubSpot. We only use this information to support your student.</p>
        </div>
      </aside>
    </div>
  </section>

  <!-- Footer (UNIFIED) -->
  <footer id="footer" class="footer fx" role="contentinfo">
    <div class="container footer__inner">
      <!-- Left: brand + mission -->
      <section class="footer__brand">
        <a class="footer__logo" href="index.html" aria-label="SHNP home">
          <span class="footer__logo-mark"></span>
          <span class="footer__logo-text">SHNP</span>
        </a>

        <p class="footer__mission">
          Empowering youth and families with mentorship, tours, scholarships, and accredited care that improves outcomes.
        </p>

        <ul class="footer__socials" role="list">
          <li><a href="https://x.com/" target="_blank" rel="noopener" aria-label="X">X</a></li>
          <li><a href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Instagram">Instagram</a></li>
          <li><a href="https://facebook.com/" target="_blank" rel="noopener" aria-label="Facebook">Facebook</a></li>
        </ul>

        <button class="footer__back" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">
          <span class="footer__back-icon" aria-hidden="true">⌃</span>
          Back to top
        </button>
      </section>

      <!-- Right: link columns -->
      <nav class="footer__nav" aria-label="Footer">
        <div class="footer__col">
          <h3>Programs</h3>
          <ul role="list">
            <li><a href="tours.html">Tours</a></li>
            <li><a href="nellas-place.html">Nella’s Place</a></li>
            <li><a href="scholarships.html">Scholarships</a></li>
            <li><a href="events.html">Events</a></li>
          </ul>
        </div>

        <div class="footer__col">
          <h3>Get Involved</h3>
          <ul role="list">
            <li><a href="donate.html">Donate</a></li>
            <li><a href="volunteer.html">Volunteer</a></li>
            <li><a href="wish-list-wednesday.html">Wish List Wednesday</a></li>
            <li class="inline-with-pill">
              <a href="careers.html">Careers</a>
              <span class="footer-pill">We’re hiring</span>
            </li>
          </ul>
        </div>

        <div class="footer__col">
          <h3>About</h3>
          <ul role="list">
            <li><a href="our-story.html">Our Story</a></li>
            <li><a href="staff.html">Staff</a></li>
            <li><a href="partners.html">Partners & Sponsors</a></li>
            <li class="split-links">
              <a href="news.html">News</a>
              <span aria-hidden="true">/</span>
              <a href="blog.html">Blog</a>
            </li>
          </ul>
        </div>

        <div class="footer__col">
          <h3>Explore</h3>
          <ul role="list">
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="our-story.html#see-our-space">See Our Space</a></li>
            <li><a href="nellas-place.html#see-our-space">Nella’s Place Tour</a></li>
          </ul>
        </div>

        <div class="footer__col">
          <h3>Policies</h3>
          <ul role="list">
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="rules-and-regulations.html">Rules & Regulations</a></li>
            <li><a href="medical-consent.html">Medical Consent</a></li>
            <li><a href="terms.html">Terms of Use</a></li>
          </ul>
        </div>
      </nav>
    </div>

    <!-- Bottom bar -->
    <div class="footer__bar">
      <div class="container">
        © <span id="year"></span> SHNP. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- Minimal page script: HubSpot submit + UX -->
  <script>
    // Set these
    const HUBSPOT_PORTAL_ID = "YOUR_PORTAL_ID";
    const HUBSPOT_FORM_GUID = "YOUR_FORM_GUID";
    const UPLOAD_URL = "https://example.com/upload"; // put your upload endpoint or page here

    // Open external upload page
    document.getElementById("openUpload")?.addEventListener("click", () => {
      window.open(UPLOAD_URL, "_blank", "noopener,noreferrer");
    });

    // Default signature date to today
    const sigDate = document.getElementById("signature_date");
    if (sigDate && !sigDate.value) {
      const t = new Date();
      const yyyy = t.getFullYear();
      const mm = String(t.getMonth()+1).padStart(2,"0");
      const dd = String(t.getDate()).padStart(2,"0");
      sigDate.value = `${yyyy}-${mm}-${dd}`;
    }

    // Basic client validation
    function showError(input, msg) {
      const field = input.closest(".field");
      if (!field) return;
      const small = field.querySelector(".error");
      if (small) small.textContent = msg || "";
      field.classList.toggle("has-error", !!msg);
    }

    function validateRequired(id, label) {
      const el = document.getElementById(id);
      if (!el) return false;
      if (!el.value.trim()) {
        showError(el, `${label} is required`);
        el.focus();
        return false;
      }
      showError(el, "");
      return true;
    }

    function validateChecks() {
      const t = document.getElementById("agree_treatment");
      const s = document.getElementById("agree_share");
      if (!t.checked || !s.checked) {
        document.getElementById("inlineStatus").textContent = "Please accept the agreements.";
        return false;
      }
      document.getElementById("inlineStatus").textContent = "";
      return true;
    }

    // HubSpot Forms API submit
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(";").shift();
      return "";
    }

    async function submitToHubSpot(payload) {
      const url = `https://api.hsforms.com/submissions/v3/integration/submit/${HUBSPOT_PORTAL_ID}/${HUBSPOT_FORM_GUID}`;
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(text || "HubSpot submission failed");
      }
      return res.json();
    }

    document.getElementById("mcForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const required = [
        ["parent_name","Parent or guardian name"],
        ["parent_email","Email"],
        ["parent_phone","Phone"],
        ["relationship","Relationship"],
        ["student_first","Student first name"],
        ["student_last","Student last name"],
        ["student_dob","Date of birth"],
        ["consent_url","Consent file link"],
        ["signature_name","Signature name"],
        ["signature_date","Signature date"]
      ];
      for (const [id,label] of required) {
        if (!validateRequired(id, label)) return;
      }
      if (!validateChecks()) return;

      const submitBtn = document.getElementById("submitBtn");
      const status = document.getElementById("inlineStatus");
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";
      status.textContent = "";

      const fields = [
        { name: "parent_guardian_name", value: document.getElementById("parent_name").value.trim() },
        { name: "parent_guardian_email", value: document.getElementById("parent_email").value.trim() },
        { name: "parent_guardian_phone", value: document.getElementById("parent_phone").value.trim() },
        { name: "relationship_to_student", value: document.getElementById("relationship").value.trim() },

        { name: "student_first_name", value: document.getElementById("student_first").value.trim() },
        { name: "student_last_name", value: document.getElementById("student_last").value.trim() },
        { name: "student_dob", value: document.getElementById("student_dob").value },

        { name: "student_grade", value: document.getElementById("student_grade").value.trim() },
        { name: "provider_name", value: document.getElementById("provider").value.trim() },
        { name: "provider_phone", value: document.getElementById("provider_phone").value.trim() },
        { name: "insurance_info", value: document.getElementById("insurance").value.trim() },
        { name: "allergies", value: document.getElementById("allergies").value.trim() },
        { name: "current_medications", value: document.getElementById("medications").value.trim() },

        { name: "consent_file_url", value: document.getElementById("consent_url").value.trim() },

        { name: "agree_treatment", value: document.getElementById("agree_treatment").checked ? "Yes" : "No" },
        { name: "agree_share_info", value: document.getElementById("agree_share").checked ? "Yes" : "No" },

        { name: "signature_name", value: document.getElementById("signature_name").value.trim() },
        { name: "signature_date", value: document.getElementById("signature_date").value },
        { name: "notes", value: document.getElementById("notes").value.trim() }
      ];

      const hutk = getCookie("hubspotutk");
      const hs_context = {
        hutk,
        pageUri: window.location.href,
        pageName: document.title
      };

      const payload = { fields, context: hs_context };

      try {
        if (!HUBSPOT_PORTAL_ID || !HUBSPOT_FORM_GUID || HUBSPOT_PORTAL_ID === "YOUR_PORTAL_ID") {
          throw new Error("Add your HubSpot portalId and formGuid in the script.");
        }
        await submitToHubSpot(payload);

        // Success state
        const card = document.querySelector(".mc-card");
        card.innerHTML = `
          <div class="mc-success">
            <div class="mc-success-mark" aria-hidden="true">✔</div>
            <h2>Thanks. Your medical consent was submitted.</h2>
            <p class="muted">You can close this page. If you need to update anything later, reach out to our team.</p>
            <a class="btn btn-primary" href="index.html">Back to home</a>
          </div>
        `;
      } catch (err) {
        status.textContent = "There was a problem submitting the form. Check your connection and try again.";
        console.error(err);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
      }
    });

    // Clear inline errors on input
    document.querySelectorAll("#mcForm .input").forEach((el) => {
      el.addEventListener("input", () => showError(el, ""));
    });

    // Hamburger toggle (unified behavior)
    (function(){
      const nav = document.querySelector('.nav');
      const btn = document.querySelector('.menu-toggle');
      const dd  = document.getElementById('hamburger-dropdown');
      if (!nav || !btn || !dd) return;
      btn.addEventListener('click', () => {
        const open = nav.classList.toggle('open');
        btn.setAttribute('aria-expanded', String(open));
        dd.querySelectorAll('a').forEach(a => a.tabIndex = open ? 0 : -1);
        document.body.classList.toggle('drawer-open', open);
      });
      document.addEventListener('click', e => {
        if (!nav.contains(e.target)){
          nav.classList.remove('open');
          btn.setAttribute('aria-expanded','false');
          dd.querySelectorAll('a').forEach(a => a.tabIndex = -1);
          document.body.classList.remove('drawer-open');
        }
      });
    })();

    // Year in footer
    document.addEventListener('DOMContentLoaded',()=>{
      const y=document.getElementById('year');
      if(y) y.textContent=new Date().getFullYear();
    });
  </script>

  <!-- Site script -->
  <script src="js/main.js"></script>
</body>
</html>
